<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DXPool: dxpool - An object and worker pool library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DXPool
   </div>
   <div id="projectbrief">An object and thread pool library for C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">dxpool - An object and worker pool library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p><code>dxpool</code> is a header only object and worker pool library for high performance applications.</p>
<p>Objects stored in the pool can be of any type (arrays, primitive types, etc) and can be retrieved from and returned to the pool without memory allocation overhead.</p>
<p>The worker pool implementation uses pool of threads with user defined core and/or NUMA node affinity, making it ideal for thread-per-core concurrency models.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Contributing</h1>
<p>See <a class="el" href="d2/dc1/md_CONTRIBUTING.html">the contribution guide</a> for details on how to propose and submit changes to this project, always observing <a class="el" href="d3/d5c/md_CODE_OF_CONDUCT.html">the code of conduct</a>.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Supported compilers and platforms</h1>
<p><code>dxpool</code> is compatible with C++11 on the following compilers</p><ul>
<li>gcc</li>
<li>clang</li>
</ul>
<p>Supported processors:</p><ul>
<li>x86-64</li>
</ul>
<p>Operating systems:</p><ul>
<li>Linux</li>
<li>Windows (at the moment, worker pools are only supported on Linux)</li>
</ul>
<p>Though C++11 is supported, C++17 is recommended for its copy elision guarantees.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Download and usage</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Manual installation</h2>
<p><code>dxpool</code> is a header only that has no external dependencies. The easiest way to manually install the library is to download the release zip file, decompress it in the desired location and added to the project's include path.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Using &lt;tt&gt;CMake&lt;/tt&gt;</h2>
<p>The easiest way to include <code>dxpool</code> in a <code>CMake</code> project is via <code>FetchContent</code>:</p>
<div class="fragment"><div class="line">FetchContent_Declare(</div>
<div class="line">  dxpool</div>
<div class="line">  GIT_REPOSITORY https://github.com/bignacio/dxpool.git</div>
<div class="line">  GIT_TAG        0.1.0</div>
<div class="line">)</div>
<div class="line">FetchContent_MakeAvailable(dxpool)</div>
<div class="line"> </div>
<div class="line"># where TARGET_NAME is the target using dxpool</div>
<div class="line">target_include_directories(&lt;TARGET_NAME&gt; PRIVATE ${DXPOOL_INCLUDE_DIR})</div>
</div><!-- fragment --><p>The include path is available through the variable <code>DXPOOL_INCLUDE_DIR</code></p>
<h2><a class="anchor" id="autotoc_md6"></a>
Using Conan</h2>
<p><em>Coming soon</em></p>
<h1><a class="anchor" id="autotoc_md7"></a>
The object pool</h1>
<p>Objects are instantiated and added to the pool at pool's construction time. Currently object types <b>must be default constructible</b>. This means the pool size (number of items in the pool) will not change through its lifetime.</p>
<p>This an intentional design decision, for the time being, and applies best to uses cases where memory usage must be consistent and deterministic.</p>
<p>The <code>StaticPool</code> statically allocates the pool size and its elements. In this case, the pool size is provided as a template parameter.</p>
<p>The <code>RuntimePool</code> permits developers to specify the size of the pool at runtime but in this case, the type of the objects in the pool must be *move constructible (note the pool size still won't change after its construction).</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Concurrency support</h2>
<p>All object pools are thread safe and allow different mechanisms for data safety via what is called an <code>Indexer</code>.</p>
<p>The <code>MutexIndexer</code> is the default mechanism and, as the name suggests, is backed by an <code>std::mutex</code>.</p>
<p>The <b>experimental</b> <code>ConcurrentIndexer</code> users lock free patterns for data safety and even though it is not lock free (due to the presence of a spin lock), the <code>ConcurrentIndexer</code> substantially reduces the probability that a thread would block making it ideal for high concurrency situations.</p>
<p>The <code>ConcurrentIndexer</code> can be between 20% and 30% than the <code>MutexIndexer</code> faster due to fewer points of contention accessing the pool.</p>
<p>You can use the [benchmark tests](benchmark) to verify the nominal execution performance on your target systems.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Retrieving and returning items</h2>
<p>Items retrieved from the pool are wrapped in a <code>PoolType</code> object that has <code>Empty() == true</code> if there are no available objects in the pool. Retrieving items from the pool will never block waiting for an available item.</p>
<p>Items are returned to the pool automatically through RIIA and allow for custom code to be invoked and reset items before returning them to the pool.</p>
<p>For more details consult [examples](examples), [tests](test) and the API <a href="http://github.com/bignacio/dxpool">documentation</a>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Putting it all together</h2>
<p>Declaring and using an static pool </p><div class="fragment"><div class="line">// a static pool containing 50 strings using the MutexIndexer</div>
<div class="line">dxpool:StaticPool&lt;std::string, 50, MutexIndexer&gt; pool;</div>
<div class="line"> </div>
<div class="line">auto item = pool.Take();</div>
<div class="line">if(!item.Empty()){</div>
<div class="line">  std::string* stringFromThePool = item.Get();</div>
<div class="line">}</div>
<div class="line">// item will be returned to the pool here when out of scope</div>
<div class="line"> </div>
<div class="line">....</div>
<div class="line"> </div>
<div class="line">// a runtime size defined pool containing 10 of array buffers using the ConcurrentIndexer</div>
<div class="line">dxpool::RuntimePool&lt;std::array&lt;char, 10&gt;, ConcurrentIndexer&gt; pool(10);</div>
<div class="line">// use the pool here</div>
<div class="line">...</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
The worker pool</h1>
<p>The worker pool creates a fixed set of threads, each with specific core affinity.</p>
<p>The <code>Processor</code> interface allow the interrogation of supported cores and NUMA nodes that can then be passed to an instance of the <code>WorkerPoolBuilder</code> which in turn will create the pool threads with the desire affinity for specific cores or an entire NUMA node. The builder allows creating a set of workers for either a NUMA node or a set of cores but not both. The builder will throw <code>InvalidWorkerPoolBuilderArgumentsError</code> in case of a mismatch in the pool configuration.</p>
<p>Even though a worker pool can have threads with affinity across NUMA nodes, it is recommended a single worker pool per node for memory intensive applications.</p>
<p>There are 2 ways the method <code>Submit</code> can be used. In the simplest case, a <code>WorkQueue::WorkerTask</code> can be added to the work queue to be executed as a fire-and-forget task.</p>
<p>The other way is to invoke <code>Submit</code> with a given task and its arguments, where the result of the execution can be later obtained via the returned <code>std::promise</code>. For example</p>
<div class="fragment"><div class="line">auto sumTask = [](int valueA, int valueB) -&gt; int { return valueA + valueB;};</div>
<div class="line">auto result = pool-&gt;Submit&lt;decltype(sumTask), int, int, int&gt;(std::move(sumTask), 1, 1);</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; &quot;the sum is &quot; &lt;&lt; result.get() &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Worker pools have thread safety guarantees and can be used concurrently by multiple threads.</p>
<p>Examples of creating and using worker pools </p><div class="fragment"><div class="line">  // a worker pool of 1 thread for all available cores</div>
<div class="line">  dxpool::Processor processor;</div>
<div class="line">  const auto cores = processor.FindAvailableCores();</div>
<div class="line"> </div>
<div class="line">  dxpool::WorkerPoolBuilder builder;</div>
<div class="line">  auto pool = builder.OnCores(cores) // use all cores</div>
<div class="line">              .WithThreadsPerCore(1) // create one thread per core</div>
<div class="line">              .Build();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">// a worker pool with 2 threads for the first NUMA node available</div>
<div class="line"> </div>
<div class="line">dxpool::Processor processor;</div>
<div class="line">const auto node = processor.FindAvailableNumaNodes();</div>
<div class="line"> </div>
<div class="line">dxpool::WorkerPoolBuilder builder;</div>
<div class="line">auto pool = builder.OnNUMANode(*node.begin())</div>
<div class="line">                .WithThreadsPerCore(2)</div>
<div class="line">                .Build();</div>
</div><!-- fragment --><p>For more details consult [examples](examples), [tests](test) and the API <a href="http://github.com/bignacio/dxpool">documentation</a>.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Notes on task execution</h2>
<p>Upon calling <code>Submit</code> tasks are added to a task queue and executed when there's an available worker.</p>
<p>This means tasks are not executed immediately and can even starve if workers never become available.</p>
<p>There's also a performance cost for submitting tasks so make sure to benchmark your code frequently. Increasing concurrency and parallelism do not always improve system performance. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
